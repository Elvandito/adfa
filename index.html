<!doctype html>

<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MP4 → MP3 (Audio Only) — Converter</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#06b6d4;--muted:#9aa4b2;--hover:#0ea5a1}
    *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{margin:0;background:linear-gradient(180deg,#071226 0%,#081426 100%);color:#e6eef6;min-height:100vh;display:grid;place-items:center;padding:28px}
    .card{width:100%;max-width:760px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:16px;padding:24px;box-shadow:0 6px 30px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03)}
    h1{margin:0 0 6px;font-size:22px;text-align:center}
    p.lead{margin:0 0 18px;color:var(--muted);font-size:13px;text-align:center}
    .row{display:flex;gap:12px;flex-wrap:wrap;margin-top:14px}
    .filebox{flex:1;min-width:220px}
    input[type=file]{display:block;width:100%;padding:12px;border-radius:8px;background:transparent;border:1px dashed rgba(255,255,255,0.06);color:inherit;cursor:pointer}
    .controls{display:flex;gap:8px;margin-top:12px;justify-content:center;flex-wrap:wrap}
    button{background:linear-gradient(90deg,var(--accent),#0ea5a1);border:none;padding:10px 14px;border-radius:10px;color:#012;cursor:pointer;font-weight:600;transition:0.2s}
    button:hover{transform:translateY(-2px);background:linear-gradient(90deg,var(--hover),var(--accent))}
    button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.05);color:var(--muted);font-weight:600}
    button.secondary:hover{color:#fff;border-color:rgba(255,255,255,0.2)}
    .progress{height:12px;background:rgba(255,255,255,0.03);border-radius:999px;overflow:hidden;margin-top:12px}
    .bar{height:100%;width:0%;background:linear-gradient(90deg,#06b6d4,#0ea5a1)}
    .log{margin-top:12px;font-size:13px;color:var(--muted);min-height:28px;text-align:center}
    .download{display:flex;gap:8px;margin-top:12px;align-items:center;justify-content:center}
    a.download-link{background:#0b1220;padding:10px 12px;border-radius:10px;color:var(--accent);text-decoration:none;border:1px solid rgba(6,182,212,0.12)}
    small{color:var(--muted)}
    footer{margin-top:20px;color:var(--muted);font-size:12px;text-align:center}/* Music Player */
.player{display:none;flex-direction:column;align-items:center;margin-top:20px;background:rgba(255,255,255,0.02);padding:16px;border-radius:16px;backdrop-filter:blur(6px);border:1px solid rgba(255,255,255,0.03)}
.album-art{width:90px;height:90px;border-radius:12px;background:linear-gradient(135deg,#06b6d4,#0ea5a1);margin-bottom:12px;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px rgba(6,182,212,0.3)}
.album-art i{font-size:42px;color:#012}
.track-name{font-weight:600;font-size:15px;margin-bottom:4px;text-align:center}
.track-meta{font-size:12px;color:var(--muted);margin-bottom:10px;text-align:center}
audio{width:100%;max-width:420px;border-radius:10px;outline:none}

  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
  <div class="card">
    <h1>Converter MP4 → MP3 (audio only)</h1>
    <p class="lead">Unggah file video .mp4 dan aplikasi ini akan mengekstrak audionya lalu mengencode ke MP3 — semua berjalan di browser tanpa server.</p><div class="row">
  <div class="filebox">
    <label for="file">Pilih file MP4</label>
    <input id="file" type="file" accept="video/*,audio/*" />
    <small>Format umum: .mp4, .mov, .webm. File besar akan membutuhkan waktu lebih lama.</small>
  </div>
  <div style="min-width:220px">
    <label for="bitrate">Bitrate MP3</label>
    <select id="bitrate" style="display:block;width:100%;padding:10px;border-radius:8px;margin-top:6px;background:transparent;border:1px solid rgba(255,255,255,0.04)">
      <option value="64">64 kbps (kecil)</option>
      <option value="96">96 kbps</option>
      <option value="128" selected>128 kbps (baik)</option>
      <option value="192">192 kbps (lebih baik)</option>
    </select>
    <div style="margin-top:10px;font-size:12px;color:var(--muted)">Sample rate mengikuti file asli.</div>
  </div>
</div>

<div class="controls">
  <button id="convert"><i class="fa-solid fa-gears"></i> Konversi</button>
  <button id="reset" class="secondary"><i class="fa-solid fa-rotate"></i> Reset</button>
</div>

<div class="progress" style="display:none"><div class="bar"></div></div>
<div class="log" id="log">Siap.</div>

<div class="download" id="downloadArea" style="display:none">
  <a id="downloadLink" class="download-link" download><i class="fa-solid fa-download"></i> Download MP3</a>
  <div id="meta" style="font-size:13px;color:var(--muted)"></div>
</div>

<div class="player" id="player">
  <div class="album-art"><i class="fa-solid fa-music"></i></div>
  <div class="track-name" id="trackName">Audio.mp3</div>
  <div class="track-meta" id="trackMeta">Durasi: —</div>
  <audio id="audioPlayer" controls></audio>
</div>

<footer>Teknologi: Web Audio API + <em>lamejs</em>. Semua proses dilakukan di perangkat Anda.</footer>

  </div>  <script src="https://cdn.jsdelivr.net/npm/lamejs@1.2.0/lame.min.js"></script>  <script>
    const fileEl = document.getElementById('file');
    const convertBtn = document.getElementById('convert');
    const resetBtn = document.getElementById('reset');
    const logEl = document.getElementById('log');
    const progressWrap = document.querySelector('.progress');
    const bar = document.querySelector('.bar');
    const downloadArea = document.getElementById('downloadArea');
    const downloadLink = document.getElementById('downloadLink');
    const metaEl = document.getElementById('meta');
    const bitrateEl = document.getElementById('bitrate');
    const player = document.getElementById('player');
    const trackName = document.getElementById('trackName');
    const trackMeta = document.getElementById('trackMeta');
    const audioPlayer = document.getElementById('audioPlayer');

    let audioBlobGlobal = null;

    function log(msg){ logEl.textContent = msg }

    resetBtn.addEventListener('click', ()=>{
      fileEl.value = '';
      log('Siap.');
      progressWrap.style.display='none'; bar.style.width='0%';
      downloadArea.style.display='none'; audioBlobGlobal=null; player.style.display='none';
    });

    async function fileToArrayBuffer(file){ return await file.arrayBuffer(); }
    async function decodeAudio(arrayBuffer){
      const ctx = new (window.OfflineAudioContext || window.AudioContext)({length:1,sampleRate:44100});
      try{return await ctx.decodeAudioData(arrayBuffer.slice(0));}
      catch(e){const ac = new (window.AudioContext||window.webkitAudioContext)();return await ac.decodeAudioData(arrayBuffer.slice(0));}
    }

    convertBtn.addEventListener('click', async ()=>{
      const file = fileEl.files[0];
      if(!file){ log('Pilih file video terlebih dahulu.'); return; }
      log('Membaca file...');
      progressWrap.style.display='block'; bar.style.width='5%'; downloadArea.style.display='none';
      try{
        const arrayBuffer = await fileToArrayBuffer(file);
        bar.style.width='15%'; log('Mendekode audio...');
        const audioBuffer = await decodeAudio(arrayBuffer);
        const channels = audioBuffer.numberOfChannels;
        const sampleRate = audioBuffer.sampleRate;
        const kbps = parseInt(bitrateEl.value,10);
        log('Meng-encode ke MP3...');

        const mp3encoder = new lamejs.Mp3Encoder(channels, sampleRate, kbps);
        const samplesPerFrame = 1152;
        let mp3Data = [];
        const channelData = [];
        for(let c=0;c<channels;c++) channelData.push(audioBuffer.getChannelData(c));
        const totalSamples = audioBuffer.length;
        let offset = 0;
        while(offset < totalSamples){
          const left = new Int16Array(Math.min(samplesPerFrame, totalSamples - offset));
          const right = channels>1 ? new Int16Array(left.length) : null;
          for(let i=0;i<left.length;i++){
            left[i] = Math.round(channelData[0][offset + i] * 32767);
            if(channels>1) right[i] = Math.round(channelData[1][offset + i] * 32767);
          }
          const mp3buf = channels>1 ? mp3encoder.encodeBuffer(left,right) : mp3encoder.encodeBuffer(left);
          if(mp3buf.length>0) mp3Data.push(new Uint8Array(mp3buf));
          offset += left.length;
          const percent = Math.min(90, Math.round((offset/totalSamples)*90));
          bar.style.width = percent + '%';
        }
        const endBuf = mp3encoder.flush();
        if(endBuf.length>0) mp3Data.push(new Uint8Array(endBuf));
        let mp3Blob = new Blob(mp3Data, {type:'audio/mp3'});
        audioBlobGlobal = mp3Blob;
        bar.style.width='100%';

        const outName = (file.name || 'audio').replace(/\.[^.]+$/, '') + '.mp3';
        downloadLink.href = URL.createObjectURL(mp3Blob);
        downloadLink.download = outName;
        downloadLink.textContent = 'Download: ' + outName;
        metaEl.textContent = `Ukuran: ${Math.round(mp3Blob.size/1024)} KB`;
        trackName.textContent = outName;
        trackMeta.textContent = `Durasi: ${Math.round(audioBuffer.duration)} detik`;
        audioPlayer.src = URL.createObjectURL(mp3Blob);
        player.style.display='flex';
        downloadArea.style.display='flex';
        log('Selesai!');
      }catch(err){console.error(err);log('Terjadi kesalahan: ' + (err.message||err));progressWrap.style.display='none';}
    });
  </script></body>
</html>